{% extends 'layouts/plantilla2.html'%}
{% load static %}

{% block head %}
<title>Gestion entrenadores</title>
<link rel="stylesheet" href="{% static 'entrenador/css/entrenador.css' %}">
<style>
:root {
  --portada-bg: url('{% static "partida/img/5.png" %}');
}
</style>
{% endblock %}


{% block content %}
<div class="grid-main">
    <section class="portada-container">
        <div class="titulo">
            <h2>Gesti√≥n Entrenadores y Postulantes</h2>
        </div>
        <div class="menu">
            <ui>
                <li data-target="#entrenadores">Entrenadores</li>
                <li data-target="#postulantes">Postulantes</li>
                <li data-target="#jornadas">Jornadas y Categorias</li>
            </ui>
        </div>
    </section>
    <section class="paginas-container">
        <div data-content id="entrenadores" class="active">
            <section class="titulo">
                <h3>Personal T</h3>
                <div class="line"></div>
                </section>
            <!-- Filtros arriba y fuera del contenedor de la tabla -->
            <div class="filtros-bar">
                <form method="get" action="" class="filtros-form">
                    <input type="text" name="q" value="{{ request.GET.q|default:'' }}" placeholder="Buscar por nombre..." class="filtro-buscar" id="buscar-input">
                    <button type="button" id="btn-limpiar" class="filtro-btn-limpiar" style="display:none;">Limpiar</button>
                    <button type="submit" name="rol" value="todos" class="filtro-btn {% if request.GET.rol == 'todos' or not request.GET.rol %}active{% endif %}">Todos</button>
                    <button type="submit" name="rol" value="Entrenador" class="filtro-btn {% if request.GET.rol == 'Entrenador' %}active{% endif %}">Entrenadores</button>
                    <button type="submit" name="rol" value="Administrador" class="filtro-btn {% if request.GET.rol == 'Administrador' %}active{% endif %}">Administradores</button>
                </form>
            </div>
            <section class="entrenadores-container">
                <div class="entrenadores-cards-wrapper" style="width:100%;">
                    <h3 style="margin:0 0 10px 0; color:#0e245c; font-weight:700;">Personal T</h3>
                    <div class="cards-grid">
                        {% for p in personales %}
                        <div class="entrenador-card {% if not p.estado %}inactivo{% endif %}">
                            <div class="card-header">
                                <div class="avatar" aria-hidden="true">
                                    <span class="avatar-initial">{{ p.fk_persona.nom1_persona|slice:":1" }}</span>
                                </div>
                                <div class="info">
                                    <h3 class="nombre">{{ p.fk_persona.nom1_persona }}{% if p.fk_persona.nom2_persona %} {{ p.fk_persona.nom2_persona|slice:":1" }}.{% endif %} {{ p.fk_persona.ape1_persona }}{% if p.fk_persona.ape2_persona %} {{ p.fk_persona.ape2_persona|slice:":1" }}.{% endif %}</h3>
                                    <p class="email">{{ p.fk_persona.email_persona }}</p>
                                </div>
                            </div>
                            <div class="card-actions">
                                <form method="post" action="{% url 'entrenador' %}" class="role-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="id" value="{{ p.fk_persona.id_persona }}">
                                    <select name="tipo_personal" class="role-select" data-current-role="{{ p.tipo_personal }}">
                                        <option value="Entrenador" {% if p.tipo_personal == 'Entrenador' %}selected{% endif %}>Entrenador</option>
                                        <option value="Administrador" {% if p.tipo_personal == 'Administrador' %}selected{% endif %}>Administrador</option>
                                    </select>
                                </form>
                                <form method="post" action="{% url 'entrenador' %}" class="estado-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="id" value="{{ p.fk_persona.id_persona }}">
                                    <input type="hidden" name="estado" value="0">
                                    <label class="switch">
                                        <input type="checkbox" name="estado" value="1" class="estado-checkbox" data-current-state="{% if p.estado %}1{% else %}0{% endif %}" {% if p.estado %}checked{% endif %}>
                                        <span class="slider round"></span>
                                    </label>
                                </form>
                                <button type="button" class="editar edit-btn" title="Editar" data-bs-toggle="modal" data-bs-target="#editar"
                                    data-nom1="{{ p.fk_persona.nom1_persona }}"
                                    data-nom2="{{ p.fk_persona.nom2_persona|default:'' }}"
                                    data-ape1="{{ p.fk_persona.ape1_persona }}"
                                    data-ape2="{{ p.fk_persona.ape2_persona|default:'' }}"
                                    data-email="{{ p.fk_persona.email_persona }}"
                                    data-rol="{{ p.tipo_personal }}"
                                    data-estado="{% if p.estado %}Activo{% else %}Inactivo{% endif %}"
                                    data-tel="{{ p.fk_persona.tel_persona }}"
                                    data-direc="{{ p.fk_persona.direc_persona }}"
                                    data-tipoid="{{ p.fk_persona.tipo_identidad }}"
                                    data-idpersona="{{ p.fk_persona.id_persona }}"
                                    data-fecha_nac="{{ p.fk_persona.fecha_nacimiento|date:'Y-m-d' }}"
                                    data-eps="{{ p.fk_persona.eps }}"
                                    data-rh="{{ p.fk_persona.rh }}"
                                    data-genero="{{ p.fk_persona.genero }}"
                                ><span aria-hidden="true">‚úé</span></button>
                            </div>
                        </div>
                        {% empty %}
                        <p style="grid-column:1/-1; margin:0; padding:12px; background:#fff; border:1px solid #e2e6ee; border-radius:10px; text-align:center;">No hay entrenadores o administradores para mostrar.</p>
                        {% endfor %}
                    </div>
                </div>
            </section>
        </div>

        <div data-content id="postulantes">
            <section class="titulo">
                <h3>Entrenadores Postulados</h3>
                <div class="line"></div>
                <div class="postulantes-tools" style="margin-top:10px; display:flex; gap:12px; flex-wrap:wrap;">
                    <button type="button" id="btn-puntajes" class="filtro-btn postulantes-tool-btn">üìä Mostrar puntaje de postulantes</button>
                    <button type="button" id="btn-mejores" class="filtro-btn postulantes-tool-btn">‚≠ê Traer las mejores opciones</button>
                    <button type="button" id="btn-limpiar-puntajes" class="filtro-btn postulantes-tool-btn">üßπ Limpiar puntajes</button>
                </div>
                <div id="mejoresMensaje" style="margin-top:8px; font-size:0.8rem; color:#0e4da0;"></div>
            
            <section class="postulantes-container">
                <div class="postulante-cards-grid">
                    {% for p in postulantes %}
                    <div class="postulante-card">
                        <div class="pc-avatar" aria-hidden="true"><span>{{ p.fk_persona.nom1_persona|slice:":1" }}</span></div>
                        <div class="pc-header">
                            <div class="pc-info">
                                <h4 class="pc-nombre">{{ p.fk_persona.nom1_persona }}{% if p.fk_persona.nom2_persona %} {{ p.fk_persona.nom2_persona }}{% endif %} {{ p.fk_persona.ape1_persona }}{% if p.fk_persona.ape2_persona %} {{ p.fk_persona.ape2_persona }}{% endif %}</h4>
                                <p class="pc-email">{{ p.fk_persona.email_persona }}</p>
                                <div class="pc-score" data-score-for="{{ p.fk_persona.id_persona }}" style="display:none; margin-top:6px; font-size:0.85rem; font-weight:700; background:#dbeafe; color:#1e3a8a; padding:6px 12px; border-radius:16px; width:max-content; border:2px solid #93c5fd; box-shadow:0 2px 4px rgba(0,0,0,0.06); letter-spacing:.3px;">
                                    Puntaje: <span class="pc-score-value">0</span>
                                    <span class="pc-score-extra" style="display:block; font-size:0.65rem; font-weight:500; margin-top:2px; color:#334155;">Exp:0 | Hab:0</span>
                                </div>
                            </div>
                        </div>
                        <div class="pc-actions-main">
                            <form method="post" action="{% url 'entrenador' %}" class="pc-inline-form">
                                {% csrf_token %}
                                <input type="hidden" name="id" value="{{ p.fk_persona.id_persona }}">
                                <input type="hidden" name="accion_postulante" value="aceptar">
                                <button type="submit" class="btn-aceptar" title="Aceptar postulante">‚úî Aceptar</button>
                            </form>
                            <form method="post" action="{% url 'entrenador' %}" class="pc-inline-form">
                                {% csrf_token %}
                                <input type="hidden" name="id" value="{{ p.fk_persona.id_persona }}">
                                <input type="hidden" name="accion_postulante" value="rechazar">
                                <button type="submit" class="btn-rechazar" title="Rechazar postulante">‚úñ Rechazar</button>
                            </form>
                        </div>
                        <div class="pc-footer">
                            <button type="button" class="btn-verinfo btn-ver" data-bs-toggle="modal" data-bs-target="#verdatos"
                                data-nom1="{{ p.fk_persona.nom1_persona }}"
                                data-nom2="{{ p.fk_persona.nom2_persona|default:'' }}"
                                data-ape1="{{ p.fk_persona.ape1_persona }}"
                                data-ape2="{{ p.fk_persona.ape2_persona|default:'' }}"
                                data-email="{{ p.fk_persona.email_persona }}"
                                data-tel="{{ p.fk_persona.tel_persona }}"
                                data-direc="{{ p.fk_persona.direc_persona }}"
                                data-tipoid="{{ p.fk_persona.tipo_identidad }}"
                                data-idpersona="{{ p.fk_persona.id_persona }}"
                                data-personapk="{{ p.fk_persona.id }}"
                                data-fecha_nac="{{ p.fk_persona.fecha_nacimiento|date:'Y-m-d' }}"
                                data-eps="{{ p.fk_persona.eps }}"
                                data-rh="{{ p.fk_persona.rh }}"
                                data-genero="{{ p.fk_persona.genero }}"
                                data-experiencia="{{ p.experiencia|default:'0' }}"
                                data-especialidad="{{ p.descripcion_especialidad|default:'No especificada' }}"
                                data-hoja-vida="{% if p.hoja_vida %}{{ p.hoja_vida.url }}{% endif %}"
                                data-tarjeta-prof="{% if p.tarjeta_profesional %}{{ p.tarjeta_profesional.url }}{% endif %}"
                            >üëÅ Ver Informaci√≥n</button>
                        </div>
                    </div>
                    {% empty %}
                    <p style="grid-column:1/-1; text-align:center; background:#fff; padding:14px; border:1px solid #e2e6ee; border-radius:10px;">No hay postulantes en este momento.</p>
                    {% endfor %}
                </div>
                <!-- Contenedor din√°mico para puntajes -->
                <div id="puntajesPostulantes" style="display:none;"></div>
            </section>
        </div>

        <div data-content id="jornadas">
            <section class="titulo">
                <h3>Asignaci√≥n de Jornadas</h3>
                <div class="line"></div>
            </section>
            <section class="jornadas-container">
                <div class="jornadas-wrapper">
                    <!-- Fila Superior: Crear y Asignaciones lado a lado -->
                    <div class="jornadas-top">
                        <!-- Crear y Asignar Jornada -->
                        <div class="jornada-card jornada-card-compact">
                            <div class="card-header-jornada">
                                <span class="icon-jornada">üìÖ</span>
                                <h4>Creaci√≥n y Asignaci√≥n de Jornada</h4>
                            </div>
                            <p>Selecciona categor√≠a, jornada y entrenador</p>
                            <form id="form-crear-jornada" method="post" action="{% url 'entrenador' %}">
                                {% csrf_token %}
                                <div class="form-group-compact">
                                    <label>Categor√≠a</label>
                                    <div class="checkbox-group-compact">
                                        {% for categoria in categorias %}
                                        <div class="checkbox-item-compact">
                                            <input type="radio" name="categoria" value="{{ categoria.idcategoria }}" id="cat_{{ categoria.idcategoria }}" required>
                                            <label for="cat_{{ categoria.idcategoria }}">{{ categoria.nom_categoria }}</label>
                                        </div>
                                        {% empty %}
                                        <small style="color:#64748b; font-style:italic;">No hay categor√≠as disponibles</small>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="form-group-compact">
                                    <label for="jornada_select">Jornada</label>
                                    <select name="jornada" id="jornada_select" class="select-compact" required>
                                        <option value="">-- Selecciona jornada --</option>
                                        {% for jornada in jornadas %}
                                        <option value="{{ jornada.idjornada }}">{{ jornada.dia_jornada }} ({{ jornada.hora_entrada|time:"g:ia" }}-{{ jornada.hora_salida|time:"g:ia" }})</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group-compact">
                                    <label for="entrenador_select">Entrenador</label>
                                    <select name="entrenador" id="entrenador_select" class="select-compact" required>
                                        <option value="">-- Selecciona entrenador --</option>
                                        {% for entrenador in entrenadores %}
                                        <option value="{{ entrenador.fk_persona.id_persona }}">{{ entrenador.fk_persona.nom1_persona }} {{ entrenador.fk_persona.ape1_persona }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <button type="submit" name="accion_jornada" value="crear" class="btn-jornada-submit">‚úì Crear Jornada</button>
                            </form>
                        </div>

                        <!-- Entrenadores con Jornadas -->
                        <div class="jornada-card jornada-card-compact">
                            <div class="card-header-jornada">
                                <span class="icon-jornada">üìã</span>
                                <h4>Entrenadores Asignados</h4>
                            </div>
                            <div class="asignaciones-grid">
                                {% for item in entrenadores_con_jornadas %}
                                <div class="asignacion-item-compact">
                                    <div class="asignacion-details">
                                        <div class="asignacion-entrenador">üë§ {{ item.entrenador.fk_persona.nom1_persona }} {{ item.entrenador.fk_persona.ape1_persona }}</div>
                                        <div class="asignacion-jornada" style="font-size: 0.85rem; color: #64748b;">
                                            {{ item.num_jornadas }} jornada{{ item.num_jornadas|pluralize }}
                                        </div>
                                    </div>
                                    <button class="btn-editar-compact" data-bs-toggle="modal" data-bs-target="#verJornadas"
                                        data-entrenador-id="{{ item.entrenador.fk_persona.id_persona }}"
                                        data-entrenador-nombre="{{ item.entrenador.fk_persona.nom1_persona }} {{ item.entrenador.fk_persona.ape1_persona }}">üëÅ Ver Jornadas</button>
                                </div>
                                {% empty %}
                                <p style="text-align:center; color:#64748b; font-style:italic; padding:20px;">No hay entrenadores con jornadas asignadas</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>


    <!-- Modal editar entrenador -->
    <div class="modal fade modal-lg" id="editar" tabindex="-1" aria-labelledby="editararia" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="editararia">Editar Entrenador Registrado</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="form-editar-entrenador" method="post" action="{% url 'entrenador' %}">
                        {% csrf_token %}
                        <div class="informacionGeneral" data-aos="zoom-in">
                            <h2>Datos Generales üë§</h2>
                            <div class="input-container">
                                <label for="tipo_identificacion">Tipo de Identificaci√≥n: </label>
                                <input type="text" name="tipo_identificacion" id="tipo_identificacion" required readonly
                                    placeHolder="Ingresa un tipo de id..">
                            </div>

                            <div class="input-container">
                                <label for="id">N√∫mero de Identificaci√≥n: </label>
                                <input type="text" name="id" id="id" required placeHolder="Ingresa un numero..">
                            </div>
                            
                            <div class="input-container">
                                <label for="nom1_persona">Primer Nombre: </label>
                                <input type="text" name="nom1_persona" id="nom1_persona" required
                                    placeHolder="Ingresa un nombre..">
                            </div>

                            <div class="input-container">
                                <label for="nom2_persona">Segundo Nombre : </label>
                                <input type="text" name="nom2_persona" id="nom2_persona"
                                    placeHolder="Ingresa un nombre..">
                            </div>

                            <div class="input-container">
                                <label for="ape1_persona">Primer Apellido: </label>
                                <input type="text" name="ape1_persona" id="ape1_persona" required
                                    placeHolder="Ingresa un nombre..">
                            </div>

                            <div class="input-container">
                                <label for="ape2_persona">Segundo Apellido: </label>
                                <input type="text" name="ape2_persona" id="ape2_persona" required
                                    placeHolder="Ingresa un nombre..">
                            </div>

                            <!-- Rol moved to inline table control; removed from modal to avoid duplicate editing -->

                            <div class="input-container">
                                <label for="genero">Genero: </label>
                                <select name="genero" id="genero" required>
                                    <option value="">--Seleccione--</option>
                                    <option value="M">M</option>
                                    <option value="F">F</option>
                                </select>
                            </div>

                            <div class="input-container">
                                <label for="fecha_nacimiento">Fecha Nacimiento: </label>
                                <!-- Fecha es campo no editable -->
                                <input type="text" name="fecha_nacimiento" id="fecha_nacimiento" required readonly
                                    placeHolder="Ingresa un nombre..">
                            </div>
                        </div>
                        <div class="datosFisicos" data-aos="zoom-in">
                            <h2>Datos Fisicos ‚ù§Ô∏è</h2>
                            <div class="input-container">
                                <label for="rhs">Tipo de Sangre: </label>
                                <!-- Mostrar tipo de sangre como no editable pero enviar su valor mediante input hidden -->
                                <select id="rhs" disabled>
                                    <option value="">--Seleccione--</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                </select>
                                <input type="hidden" name="rhs" id="rhs_hidden">
                            </div>
                            <div class="input-container">
                                <label for="eps">Eps: </label>
                                <select name="eps" id="eps" required>
                                    <option value="">--Seleccione--</option>
                                    <option value="Sanitas">Sanitas</option>
                                    <option value="Sura">Sura</option>
                                    <option value="Compensar">Compensar</option>
                                    <option value="Salud Total">Salud Total</option>
                                    <option value="Famisanar">Famisanar</option>
                                    <option value="Capital Salud">Capital Salud</option>
                                    <option value="Aliansalud">Aliansalud</option>
                                    <option value="Salud Bolivar">Salud Bolivar</option>
                                </select>
                            </div>
                        </div>

                        <div class="datosContactos" data-aos="zoom-in">
                            <h2>Informaci√≥n de Contacto üìû</h2>
                            <div class="input-container">
                                <label for="direc_persona">Direcci√≥n domicilio: </label>
                                <input type="text" name="direc_persona" id="direc_persona" required
                                    placeHolder="Ingresa un nombre..">
                            </div>
                            <div class="input-container">
                                <label for="tel_persona">N√∫mero Celular: </label>
                                <input type="text" name="tel_persona" id="tel_persona" required
                                    placeHolder="Ingresa un nombre..">
                            </div>
                            <div class="input-container">
                                <label for="email_persona">Correo Electr√≥nico: </label>
                                <input type="email" name="email_persona" id="email_persona" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$" placeholder="ejemplo@correo.com">
                            </div>
                        </div>

                        <button type="submit" class="btn-enviar">Guardar</button>
                    </form>
                    <button type="button" class="btn-regresar" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ver jornadas del entrenador -->
    <div class="modal fade" id="verJornadas" tabindex="-1" aria-labelledby="verJornadasLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="verJornadasLabel">Jornadas Asignadas</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <h5 id="ver_entrenador_nombre" style="margin-bottom: 20px; color: #0e245c;"></h5>
                    <div id="jornadas_list" style="display: flex; flex-direction: column; gap: 15px;">
                        <!-- Se llenar√° din√°micamente con JavaScript -->
                    </div>
                    <button type="button" class="btn-regresar" data-bs-dismiss="modal" style="margin-top: 20px;">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal editar jornada individual -->
    <div class="modal fade" id="editarJornada" tabindex="-1" aria-labelledby="editarJornadaLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="editarJornadaLabel">Editar Asignaci√≥n de Jornada</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="form-editar-jornada" method="post" action="{% url 'entrenador' %}">
                        {% csrf_token %}
                        <input type="hidden" name="accion_jornada" value="editar">
                        <input type="hidden" name="asignacion_id" id="edit_asignacion_id">
                        
                        <div class="form-group-compact">
                            <label>Entrenador (No editable)</label>
                            <input type="text" id="edit_entrenador_nombre" class="select-compact" readonly style="background-color: #f0f0f0; cursor: not-allowed;">
                        </div>
                        
                        <div class="form-group-compact">
                            <label>Categor√≠a</label>
                            <div class="checkbox-group-compact">
                                {% for categoria in categorias %}
                                <div class="checkbox-item-compact">
                                    <input type="radio" name="categoria" value="{{ categoria.idcategoria }}" id="edit_cat_{{ categoria.idcategoria }}" required>
                                    <label for="edit_cat_{{ categoria.idcategoria }}">{{ categoria.nom_categoria }}</label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="form-group-compact">
                            <label for="edit_jornada_select">Jornada</label>
                            <select name="jornada" id="edit_jornada_select" class="select-compact" required>
                                <option value="">-- Selecciona jornada --</option>
                                {% for jornada in jornadas %}
                                <option value="{{ jornada.idjornada }}">{{ jornada.dia_jornada }} ({{ jornada.hora_entrada|time:"g:ia" }}-{{ jornada.hora_salida|time:"g:ia" }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <button type="submit" class="btn-jornada-submit">‚úì Guardar Cambios</button>
                    </form>
                    <button type="button" class="btn-regresar" data-bs-dismiss="modal" style="margin-top: 10px;">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ver informacion -->
    <div class="modal fade modal-lg" id="verdatos" tabindex="-1" aria-labelledby="verdatosaria" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="verdatosaria">Informaci√≥n del Personal</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="informacionGeneral" data-aos="zoom-in">
                            <h2>Datos Generales üë§</h2>
                            <div class="input-container">
                                <label>Tipo de Identificaci√≥n:</label>
                                <div class="readonly-field" id="v_tipoid"></div>
                            </div>
                            <div class="input-container">
                                <label>N√∫mero de Identificaci√≥n:</label>
                                <div class="readonly-field" id="v_idpersona"></div>
                            </div>
                            <div class="input-container">
                                <label>Nombres:</label>
                                <div class="readonly-field" id="v_nombres"></div>
                            </div>
                            <div class="input-container">
                                <label>Apellidos:</label>
                                <div class="readonly-field" id="v_apellidos"></div>
                            </div>
                            <div class="input-container">
                                <label>Genero:</label>
                                <div class="readonly-field" id="v_genero"></div>
                            </div>
                            <div class="input-container">
                                <label>Fecha Nacimiento:</label>
                                <div class="readonly-field" id="v_fecha_nac"></div>
                            </div>
                        </div>
                        <div class="datosFisicos" data-aos="zoom-in">
                            <h2>Datos F√≠sicos ‚ù§Ô∏è</h2>
                            <div class="input-container">
                                <label>Tipo de Sangre:</label>
                                <div class="readonly-field" id="v_rh"></div>
                            </div>
                            <div class="input-container">
                                <label>Eps:</label>
                                <div class="readonly-field" id="v_eps"></div>
                            </div>
                        </div>
                        <div class="datosContactos" data-aos="zoom-in">
                            <h2>Informaci√≥n de Contacto üìû</h2>
                            <div class="input-container">
                                <label>Direcci√≥n domicilio:</label>
                                <div class="readonly-field" id="v_direc"></div>
                            </div>
                            <div class="input-container">
                                <label>N√∫mero Celular:</label>
                                <div class="readonly-field" id="v_tel"></div>
                            </div>
                            <div class="input-container">
                                <label>Correo Electronico:</label>
                                <div class="readonly-field" id="v_email"></div>
                            </div>
                        </div>
                        <div class="experienciaProfesional" data-aos="zoom-in">
                            <h2>Experiencia Profesional üíº</h2>
                            <div class="input-container">
                                <label>A√±os de Experiencia:</label>
                                <div class="readonly-field" id="v_experiencia"></div>
                            </div>
                            <div class="input-container">
                                <label>Descripci√≥n de Especialidad:</label>
                                <div class="readonly-field" id="v_especialidad" style="white-space: pre-wrap;"></div>
                            </div>
                            <div class="input-container">
                                <label>Hoja de Vida (PDF):</label>
                                <div class="readonly-field" id="v_hoja_vida"></div>
                            </div>
                            <div class="input-container">
                                <label>Tarjeta Profesional:</label>
                                <div class="readonly-field" id="v_tarjeta_prof"></div>
                            </div>
                        </div>
                        <div class="habilidades" data-aos="zoom-in">
                            <h2>Habilidades üéØ</h2>
                            <div id="v_habilidades" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; background: #f8fafc; border-radius: 10px;">
                                <!-- Se llenar√° din√°micamente -->
                            </div>
                        </div>
                    </form>
                    <button type="button" class="btn-regresar" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script src="{% static 'partida/scripts/paginas.js' %}"></script>
<script>























































































































































































































































































// Datos de asignaciones para el modal (generados desde el backend)
const asignacionesPorEntrenador = JSON.parse('{{ asignaciones_json|escapejs }}');
console.log('Asignaciones por entrenador:', asignacionesPorEntrenador);

// Manejar el evento de ver jornadas
document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('[data-bs-target="#verJornadas"]').forEach(function(btn){
        btn.addEventListener('click', function(e){
            const entrenadorId = e.currentTarget.dataset.entrenadorId;
            const entrenadorNombre = e.currentTarget.dataset.entrenadorNombre;
            
            console.log('Click en Ver Jornadas para entrenador ID:', entrenadorId);
            console.log('Nombre:', entrenadorNombre);
            
            // Actualizar t√≠tulo
            document.getElementById('ver_entrenador_nombre').textContent = 'üë§ ' + entrenadorNombre;
            
            // Limpiar lista de jornadas
            const jornadasList = document.getElementById('jornadas_list');
            jornadasList.innerHTML = '';
            
            // Obtener asignaciones del entrenador
            const asignaciones = asignacionesPorEntrenador[entrenadorId] || [];
            
            console.log('Asignaciones encontradas:', asignaciones);
            
            if(asignaciones.length === 0){
                jornadasList.innerHTML = '<p style="text-align:center; color:#64748b; padding:20px;">No tiene jornadas asignadas</p>';
                return;
            }
            
            // Crear un item por cada asignaci√≥n
            asignaciones.forEach(function(asig){
                const item = document.createElement('div');
                item.style.cssText = 'background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center;';
                
                item.innerHTML = `
                    <div>
                        <div style="font-weight: 700; color: #0e245c; margin-bottom: 5px;">üìö ${asig.categoria_nombre}</div>
                        <div style="font-size: 0.9rem; color: #64748b;">üìÖ ${asig.jornada_dia} (${asig.jornada_hora})</div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-editar-individual" 
                            data-id="${asig.id}"
                            data-categoria="${asig.categoria_id}"
                            data-jornada="${asig.jornada_id}"
                            data-entrenador-nombre="${entrenadorNombre}"
                            style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="btn-eliminar-jornada" 
                            data-id="${asig.id}"
                            data-categoria-nombre="${asig.categoria_nombre}"
                            data-jornada-info="${asig.jornada_dia} (${asig.jornada_hora})"
                            data-entrenador-nombre="${entrenadorNombre}"
                            style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                `;
                
                jornadasList.appendChild(item);
            });
            
            // Agregar event listeners a los botones de editar individual
            document.querySelectorAll('.btn-editar-individual').forEach(function(editBtn){
                editBtn.addEventListener('click', function(){
                    const d = this.dataset;
                    
                    // Cerrar modal de ver jornadas
                    const verJornadasModal = bootstrap.Modal.getInstance(document.getElementById('verJornadas'));
                    if(verJornadasModal) verJornadasModal.hide();
                    
                    // Abrir modal de editar jornada
                    const editarJornadaModal = new bootstrap.Modal(document.getElementById('editarJornada'));
                    editarJornadaModal.show();
                    
                    // Llenar campos del modal de edici√≥n
                    document.getElementById('edit_asignacion_id').value = d.id || '';
                    document.getElementById('edit_entrenador_nombre').value = d.entrenadorNombre || '';
                    
                    // Seleccionar la categor√≠a actual
                    const catRadio = document.getElementById('edit_cat_' + d.categoria);
                    if(catRadio) catRadio.checked = true;
                    
                    // Seleccionar la jornada actual
                    const jornadaSelect = document.getElementById('edit_jornada_select');
                    if(jornadaSelect) jornadaSelect.value = d.jornada || '';
                });
            });
            
            // Agregar event listeners a los botones de eliminar jornada
            document.querySelectorAll('.btn-eliminar-jornada').forEach(function(deleteBtn){
                deleteBtn.addEventListener('click', function(){
                    const d = this.dataset;
                    const asignacionId = d.id;
                    const categoriaNombre = d.categoriaNombre;
                    const jornadaInfo = d.jornadaInfo;
                    const entrenadorNombre = d.entrenadorNombre;
                    
                    // Mostrar confirmaci√≥n
                    const confirmar = confirm(
                        '¬øEst√° seguro que desea eliminar esta jornada?\n\n' +
                        'Entrenador: ' + entrenadorNombre + '\n' +
                        'Categor√≠a: ' + categoriaNombre + '\n' +
                        'Jornada: ' + jornadaInfo + '\n\n' +
                        'Esta acci√≥n eliminar√° la asignaci√≥n de la base de datos.'
                    );
                    
                    if(!confirmar) return;
                    
                    // Enviar petici√≥n AJAX para eliminar
                    const formData = new FormData();
                    formData.append('accion_jornada', 'eliminar');
                    formData.append('asignacion_id', asignacionId);
                    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
                    
                    fetch(window.location.href, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if(data.success){
                            // Mostrar mensaje de √©xito
                            alert('‚úì Jornada eliminada correctamente');
                            // Recargar la p√°gina para actualizar las listas
                            window.location.reload();
                        } else {
                            alert('‚ùå Error: ' + (data.message || 'No se pudo eliminar la jornada'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('‚ùå Error al eliminar la jornada');
                    });
                });
            });
        });
    });
});
</script>
<script src="{% static 'entrenador/js/entrenadores.js' %}?v=2"></script>
{% endblock %}
